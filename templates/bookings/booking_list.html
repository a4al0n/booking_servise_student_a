{% extends 'base.html' %}

{% block title %}–í—Å–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è{% endblock %}

{% block content %}
<div class="page-header">
    <h2>–í—Å–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h2>
    <div class="stats">
        <div class="stat-item">
            <span class="stat-number">{{ total_bookings }}</span>
            <span class="stat-label">–í—Å–µ–≥–æ</span>
        </div>
        <div class="stat-item stat-success">
            <span class="stat-number">{{ confirmed_count }}</span>
            <span class="stat-label">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ</span>
        </div>
        <div class="stat-item stat-danger">
            <span class="stat-number">{{ rejected_count }}</span>
            <span class="stat-label">–û—Ç–∫–ª–æ–Ω–µ–Ω–æ</span>
        </div>
    </div>
</div>

<div class="filters">
    <form method="get" class="filter-form">
        <input 
            type="email" 
            name="email" 
            placeholder="Email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
            value="{{ request.GET.email }}"
            class="form-control">
        
        <select name="status" class="form-control">
            <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
            <option value="confirmed" {% if request.GET.status == 'confirmed' %}selected{% endif %}>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ</option>
            <option value="rejected" {% if request.GET.status == 'rejected' %}selected{% endif %}>–û—Ç–∫–ª–æ–Ω–µ–Ω–æ</option>
            <option value="pending" {% if request.GET.status == 'pending' %}selected{% endif %}>–í –æ–∂–∏–¥–∞–Ω–∏–∏</option>
        </select>

        <input 
            type="date" 
            name="date" 
            placeholder="–î–∞—Ç–∞"
            value="{{ request.GET.date }}"
            class="form-control">
        
        <button type="submit" class="btn btn-primary">–§–∏–ª—å—Ç—Ä</button>
        <a href="{% url 'booking_list' %}" class="btn btn-secondary">–°–±—Ä–æ—Å–∏—Ç—å</a>
    </form>
</div>

{% if bookings %}
<div class="table-container">
    <table class="bookings-table">
        <thead>
            <tr>
                <th>ID</th>
                <th>–ê—É–¥–∏—Ç–æ—Ä–∏—è</th>
                <th>–î–∞—Ç–∞</th>
                <th>–í—Ä–µ–º—è</th>
                <th>Email</th>
                <th>–¢–∏–ø</th>
                <th>–°—Ç–∞—Ç—É—Å</th>
                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
        </thead>
        <tbody>
            {% for booking in bookings %}
            <tr class="status-{{ booking.status }}">
                <td>{{ booking.id }}</td>
                <td><strong>{{ booking.room_number }}</strong></td>
                <td>{{ booking.booking_date|date:"d.m.Y" }}</td>
                <td>{{ booking.start_time|time:"H:i" }} - {{ booking.end_time|time:"H:i" }}</td>
                <td>{{ booking.user_email }}</td>
                <td>{{ booking.get_booking_type_display }}</td>
                <td>
                    <span class="status-badge status-{{ booking.status }}">
                        {{ booking.get_status_display }}
                    </span>
                </td>
                <td>
                    <a href="{% url 'booking_detail' booking.pk %}" class="btn btn-sm">üëÅÔ∏è</a>
                    <form method="post" action="{% url 'booking_delete' booking.pk %}" style="display:inline;" 
                          onsubmit="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ?');">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-sm btn-danger">üóëÔ∏è</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% if is_paginated %}
<div class="pagination">
    {% if page_obj.has_previous %}
        <a href="?page=1" class="btn btn-sm">–ü–µ—Ä–≤–∞—è</a>
        <a href="?page={{ page_obj.previous_page_number }}" class="btn btn-sm">‚Üê –ù–∞–∑–∞–¥</a>
    {% endif %}
    
    <span class="page-info">
        –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ page_obj.number }} –∏–∑ {{ page_obj.paginator.num_pages }}
    </span>
    
    {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}" class="btn btn-sm">–î–∞–ª–µ–µ ‚Üí</a>
        <a href="?page={{ page_obj.paginator.num_pages }}" class="btn btn-sm">–ü–æ—Å–ª–µ–¥–Ω—è—è</a>
    {% endif %}
</div>
{% endif %}

{% else %}
<div class="empty-state">
    <p>üì≠ –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>
    <a href="{% url 'home' %}" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</a>
</div>
{% endif %}

{% endblock %}