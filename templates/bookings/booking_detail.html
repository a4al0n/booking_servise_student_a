{% extends 'base.html' %}

{% block title %}–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ #{{ booking.id }}{% endblock %}

{% block content %}
<div class="page-header">
    <h2>–î–µ—Ç–∞–ª–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è #{{ booking.id }}</h2>
    <div class="header-actions">
        <a href="{% url 'booking_list' %}" class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</a>
        <form method="post" action="{% url 'booking_delete' booking.pk %}" style="display:inline;"
              onsubmit="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ?');">
            {% csrf_token %}
            <button type="submit" class="btn btn-danger">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
        </form>
    </div>
</div>

<div class="booking-detail">
    <div class="detail-card">
        <div class="card-header status-{{ booking.status }}">
            <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏</h3>
            <span class="status-badge status-{{ booking.status }}">
                {% if booking.status == 'confirmed' %}‚úì{% elif booking.status == 'rejected' %}‚úó{% else %}‚è≥{% endif %}
                {{ booking.get_status_display }}
            </span>
        </div>
        
        <div class="card-body">
            <div class="info-grid">
                <div class="info-item">
                    <label>üö™ –ê—É–¥–∏—Ç–æ—Ä–∏—è</label>
                    <value>{{ booking.room_number }}</value>
                </div>
                
                <div class="info-item">
                    <label>üìÖ –î–∞—Ç–∞</label>
                    <value>{{ booking.booking_date|date:"d.m.Y (l)" }}</value>
                </div>
                
                <div class="info-item">
                    <label>‚è∞ –í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞</label>
                    <value>{{ booking.start_time|time:"H:i" }}</value>
                </div>
                
                <div class="info-item">
                    <label>‚è∞ –í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è</label>
                    <value>{{ booking.end_time|time:"H:i" }}</value>
                </div>
                
                <div class="info-item">
                    <label>üë§ Email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                    <value>{{ booking.user_email }}</value>
                </div>
                
                <div class="info-item">
                    <label>üìã –¢–∏–ø –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</label>
                    <value>{{ booking.get_booking_type_display }}</value>
                </div>
                
                {% if booking.purpose %}
                <div class="info-item full-width">
                    <label>üìù –¶–µ–ª—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</label>
                    <value>{{ booking.purpose }}</value>
                </div>
                {% endif %}
                
                <div class="info-item">
                    <label>üïê –°–æ–∑–¥–∞–Ω–æ</label>
                    <value>{{ booking.created_at|date:"d.m.Y H:i" }}</value>
                </div>
                
                <div class="info-item">
                    <label>üïê –û–±–Ω–æ–≤–ª–µ–Ω–æ</label>
                    <value>{{ booking.updated_at|date:"d.m.Y H:i" }}</value>
                </div>
            </div>
        </div>
    </div>
    
    {% if booking.availability_check_response %}
    <div class="detail-card">
        <div class="card-header">
            <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏</h3>
        </div>
        
        <div class="card-body">
            <div class="availability-result">
                {% if booking.availability_check_response.success %}
                    {% if booking.availability_check_response.available %}
                        <div class="alert alert-success">
                            <strong>‚úÖ –ê—É–¥–∏—Ç–æ—Ä–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞</strong>
                            <p>{{ booking.availability_check_response.message }}</p>
                        </div>
                    {% else %}
                        <div class="alert alert-warning">
                            <strong>‚ö†Ô∏è –ê—É–¥–∏—Ç–æ—Ä–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞</strong>
                            <p>{{ booking.availability_check_response.message }}</p>
                            
                            {% if booking.availability_check_response.conflicts %}
                            <div class="conflicts">
                                <strong>–ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã:</strong>
                                <ul>
                                    {% for conflict in booking.availability_check_response.conflicts %}
                                    <li>{{ conflict }}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                            {% endif %}
                        </div>
                    {% endif %}
                {% else %}
                    <div class="alert alert-error">
                        <strong>‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏</strong>
                        <p>{{ booking.availability_check_response.message }}</p>
                    </div>
                {% endif %}
                
                <details class="json-details">
                    <summary>–ü–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–∏—Å–∞ (JSON)</summary>
                    <pre><code>{{ booking.availability_check_response|pprint }}</code></pre>
                </details>
            </div>
        </div>
    </div>
    {% endif %}
</div>

{% endblock %}